#include <GL/glfw.h>
#define S(x)(x)*(x)
#define M(x,y)(x>y?y:x)
int main(){glfwInit();glfwOpenWindow(599,599,0,0,0,0,0,0,GLFW_WINDOW);glOrtho(0,599,599,0,1,-1);glLineWidth(2);srand(glfwGetTime());i:glClear(16384);int s=0,x,y,a,b,c,d,e,f;s:glfwGetMousePos(&a,&b);e=c=a;f=d=b;glColor3ub(0,0,0);glRecti(x-9,y-9,x+9,y+9);while((x=rand()&511)<99);while((y=rand()&511)<99);glColor3ub(0,0,0);glRecti(x-9,y-9,x+9,y+9);glColor3ub(255,0,0);glRecti(x-4,y-4,x+4,y+4);glColor3ub(0,255,255);glRecti(s*6-4,595,s*6,597);s++;glColor3ub(255,255,255);do{if(S(c-a)+S(d-b)>63&&a>-1&&b>-1&&a<600&&b<600){int i=0,j=0,k=abs(c-a)>abs(d-b);for(;k?i<abs(c-a):j<abs(d-b);k?i++:j++){if(k)j=d==b?0:i*abs(d-b)/abs(c-a);else i=c==a?0:j*abs(c-a)/abs(d-b);unsigned char g;glReadPixels(M(c,a)+i,599-M(d,b)-j,1,1,GL_RGB,GL_UNSIGNED_BYTE_3_3_2,&g);if(g==255)goto i;if(g==224)goto s;}glBegin(GL_LINES);glVertex2i(e,f);glVertex2i(e=c,f=d);glEnd();c=a;d=b;}glfwSwapBuffers();glfwGetMousePos(&a,&b);}while(!glfwGetKey(GLFW_KEY_ESC));}